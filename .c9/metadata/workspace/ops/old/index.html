{"filter":false,"title":"index.html","tooltip":"/ops/old/index.html","undoManager":{"mark":1,"position":1,"stack":[[{"start":{"row":254,"column":0},"end":{"row":279,"column":14},"action":"remove","lines":["{% block js %}","<!--JAVASCRIPT-->","\t<!--=================================================-->","","\t<!--jQuery [ REQUIRED ]-->","\t<script src=\"/static/hosts/js/jquery-2.1.1.min.js\"></script>","","\t<!--BootstrapJS [ RECOMMENDED ]-->","\t<script src=\"/static/hosts/js/bootstrap.min.js\"></script>","","\t<!--Fast Click [ OPTIONAL ]-->","\t<script src=\"/static/hosts/js/fastclick.min.js\"></script>","","\t<!--Nifty Admin [ RECOMMENDED ]-->","\t<script src=\"/static/hosts/js/nifty.min.js\"></script>","\t<script src=\"/static/plugins/bootstrap-select/bootstrap-select.min.js\"></script>","\t<script src=\"/static/plugins/js.cookie.js\"></script>","\t<script src=\"/static/plugins/jquery-ui/jquery-ui.min.js\"></script>","\t<script src=\"/static/plugins/bootstrap-fileinput/js/fileinput.js\"></script>","\t<script src=\"/static/plugins/bootstrap-fileinput/js/plugins/canvas-to-blob.js\"></script>","\t<script src=\"/static/plugins/bootstrap-fileinput/js/fileinput_locale_zh.js\"></script>","","    <script src=\"/static/plugins/bootstrap-validator/bootstrapValidator.js\"></script>","    <script src=\"/static/plugins/highstock/js/highstock.js\"></script>","    <script src=\"/static/plugins/highstock/js/modules/exporting.js\"></script>","{% endblock %}"],"id":127}],[{"start":{"row":254,"column":0},"end":{"row":450,"column":13},"action":"remove","lines":["","<script type=\"text/javascript\">","        // using jQuery","        $(document).ready(function(){","","            //var csrftoken = $.cookie('csrftoken');","            var csrftoken = Cookies.get('csrftoken');","","            function csrfSafeMethod(method) {","                // these HTTP methods do not require CSRF protection","                return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));","            }","            $.ajaxSetup({","                beforeSend: function(xhr, settings) {","                    if (!csrfSafeMethod(settings.type) && !this.crossDomain) {","                        xhr.setRequestHeader(\"X-CSRFToken\", csrftoken);","                    }","                }","            });","","        //set active menu node on left sidebar","        SetActiveMenu(\"{{active_node}}\");","","        })","","        function SetActiveMenu(active_node){","","            //console.log(\"activ---enode:: \" + active_node);","            if (active_node == ''){","                active_node = '/';","            }","            var node_ele = $(\"#mainnav-menu-wrap \"+ \" a[href='\" +active_node + \"']\").parent();","            node_ele.addClass(\"active-link\");","            if (node_ele.parent().hasClass(\"collapse\")){","                node_ele.parent().addClass(\"in\");","            }","","        }","","        //for chart","    $(function () {","","        Highcharts.setOptions({","            global: {","                timezoneOffset:new Date().getTimezoneOffset()/60","","            }","        });","","        $.getJSON(\"{% url 'dashboard_summary' %}\", function (data) {","            // Create the chart","            console.log(data);","            $('#chart-container').highcharts('StockChart', {","                credits: {","                  enabled: false","                },","                exporting: { enabled: false },","                rangeSelector : {","                    selected : 1","                },","","","                plotOptions: {","                    series: {","                        cursor: 'pointer',","                        point: {","                            events: {","                                click: function () {","                                    //alert('Category: ' + this.x + ', value: ' + this.y);","                                    $.getJSON(\"{% url 'user_login_counts' %}\", {time_stamp: this.x},function(callback){","                                        console.log(callback);","                                        ShowCurrentDayRecords(callback);","","                                    });//end getJSON","                                }","                            }","                        }","                    }","                } ,","","                series : [{","                    type:'column',","                    name : '用户数',","                    data : data.user_login_statistics,","                    tooltip: {","                        valueDecimals: 0","                    }","                }]","            });//end chart","","            recent_active_users(data);","            summary_data(data);","","        });","","    });","        //end chart","","","","    function ShowOnlineHosts(){","","","         $.getJSON(\"{% url 'dashboard_detail' %}\", {'data_type':'get_online_hosts'},function(callback){","","            console.log(callback);","            var table_html = \"<table class='table table-hover' > <tr><th>#</th><th>主机名</th><th>IP</th><th>远程用户</th><th>操作用户</th><th>登录时间</th><th></th></tr>\";","","            $.each(callback, function(index,item){","                var row = \"<tr><td>\" + index +","                        \"</td><td data-label='hostname'><a class='btn-link' href='/host/detail/?host_id=\" + item.auditlog__host__host__id + \"' >\" + item.auditlog__host__host__hostname +","                        \"</a></td><td data-label='ip_addr' >\" + item.auditlog__host__host__ip_addr +","                        \"</td><td data-label='username' >\" + item.auditlog__host__host_user__username +","                        \"</td><td>\" + item.auditlog__user__name +","                        \"</td><td>\" + item.date +","                        \"</td><td><a href='#' class='badge badge-success' onclick='ShowRecordDetail(this,\" + item.auditlog__session + \")'>查看详细</a></td></tr>\";","                table_html += row;","","            });","            $(\"#large-modal-content\").html(table_html);","","         });//end getJSON","","        $(\"#myLargeModalLabel\").html(\"当前正在连接的主机\");","        $(\"#large-modal\").modal(\"show\");","","    }","    function ShowOnlineUsers(){","","        $.getJSON(\"{% url 'dashboard_detail' %}\", {'data_type':'get_online_users'},function(callback){","","","            var table_html = \"<table class='table table-hover'><tr><th>#</th><th>在线用户</th><th>部门</th><th>登录时间</th></tr>\";","            $.each(callback,function(index,item){","                var row = \"<tr><td>\" + index +","                            \"</td><td><a class='btn-link' href='/user_audit/\" + item.userprofile__id +\"/' >\"+ item.userprofile__name +","                            \"</a></td><td>\" + item.userprofile__department +","                            \"</td><td>\" + item.last_login +\"</td></tr>\";","                table_html += row;","","            });//end each","","            $(\"#large-modal-content\").html(table_html);","        });//end getJSON","","        $(\"#myLargeModalLabel\").html(\"当前在线用户\");","        $(\"#large-modal\").modal(\"show\");","    }","","    function ShowCurrentDayRecords(data){","","        $(\"#large-modal\").modal(\"show\");","        var html_ele = \"<table class='table table-hover'><tr><th>#</th><th>登录日期</th><th>操作人</th><th>主机名</th><th>远程用户</th><th></th></tr>\";","        $.each(data,function(index,item){","            console.log(item);","            var row = \"<tr><td>\" + index +","                      \"</td><td data-label='login_date'>\" + item.date +","                      \"</td><td data-label='username'><a class='btn-link' href='/user_audit/\" + item.user + \"/'>\" + item.user__name +","                      \"</a></td><td data-label='hostname'>\" + item.host__host__hostname +","                      \"</td><td>\" + item.host__host_user__username +","                      \"</td><td> <a onclick='ShowRecordDetail(this,\" + item.session + \")' class='badge badge-success'>查看详细</a> </td>\" +","                      \"</td></tr>\";","            html_ele += row;","","","        });//end each","        html_ele += \"</table>\";","","        $(\"#large-modal-content\").html(html_ele);","","    }","","    function recent_active_users(data){","        var html_ele = '';","        $.each(data.recent_active_users,function(key,val){","           var item_ele = \"<tr><td><a class='btn-link' href='/user_audit/\" + val.user +\"/' >\" +val.user__name + \"</a><td>\" + val.user__count +\"</td><td>\" + active_user_cmd_count(data,val.user) +\"</td><tr>\";","           html_ele += item_ele;","        });","        $(\"#recent_active_users\").html(html_ele);","    };","    function active_user_cmd_count(data,user_id){","        var cmd_count;","        $.each(data.recent_active_users_cmd_count,function(key,val){","            if (val.user == user_id){","                cmd_count= val.cmd__count;","            }","        });//end each","        return cmd_count","    }","    function summary_data(data){","        $(\"#total_servers\").html(data.summary.total_servers);","        $(\"#total_users\").html(data.summary.total_users);","        $(\"#current_logging_users\").html(data.summary.current_logging_users);","        $(\"#current_connected_hosts\").html(data.summary.current_connected_hosts);","    }","","    </script>"],"id":128}]]},"ace":{"folds":[],"scrolltop":3298.5,"scrollleft":0,"selection":{"start":{"row":254,"column":0},"end":{"row":254,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":234,"state":"start","mode":"ace/mode/html"}},"timestamp":1449039986056,"hash":"1f66b0cfc68b60afae36d2ead061ca12c23b0a2c"}